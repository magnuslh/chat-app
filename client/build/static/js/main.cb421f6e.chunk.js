(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{124:function(e,t){},133:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(81),s=n.n(c),o=(n(91),n(42)),l=n(19),u=n.n(l),i=n(29),f=n(16),m=n(50),d=n(82),v=n(24);var g=function(e){var t=e.sendTyping,n=e.sendMessage,c=Object(a.useState)(""),s=Object(f.a)(c,2),o=s[0],l=s[1];Object(a.useEffect)((function(){t(!0),function(e,t,n){var a}()}),[o]);var u=function(){""!==o&&(n(o),l(""))};return r.a.createElement("div",{className:"w-full p-4 flex bg-gray-200"},r.a.createElement("input",{type:"text",name:"message",value:o,onChange:function(e){return l(e.target.value)},className:"rounded p-3 pl-6 flex-grow shadow",placeholder:"Say something...",onKeyPress:function(e){13===e.charCode&&u()}}),r.a.createElement("button",{className:"bg-blue-500 text-white rounded p-3 ml-2 shadow ",onClick:u},"Send"))},p=function(e){var t=e.createdAt,n=e.isSender,c=e.text,s=Object(a.useState)(!1),o=Object(f.a)(s,2),l=o[0],u=o[1];console.log(t);var i=n?"bg-blue-500 text-white ":"bg-gray-200 text-gray-900 ",m=new Date(t),d=m.getMinutes(),v=""+d;d<10&&(v="0"+d);var g=m.getHours()+":"+v,p=l?"visible":"invisible";return r.a.createElement("div",{className:"flex items-center"},n?r.a.createElement("div",{className:"text-gray-300 text-xs m-2 ".concat(p)},g):null,r.a.createElement("div",{onMouseOver:function(){return u(!0)},onMouseLeave:function(){return u(!1)},className:i+" inline-block rounded p-2 shadow-md"},c),n?null:r.a.createElement("div",{className:"text-gray-300 text-xs m-2 ".concat(p)},g))},b=function(e){var t=e.clients,n="";return n=0===t.length?"Looks you are the only one here":t.join(", "),r.a.createElement("div",{className:"w-full p-6 text-lg bg-gray-200 text-center text-gray-700 font-bold shadow-lg"},n)},h=function(e){var t=e.isSender,n=e.sender,a=e.children;return t?r.a.createElement("div",{className:"p-2 m-1  self-end text-right"},r.a.createElement("span",{className:" text-gray-700"},n),r.a.createElement("div",{className:"flex flex-col items-end space-y-1"},a)):r.a.createElement("div",{className:"p-2 m-1  self-start text-left "},r.a.createElement("span",{className:" text-gray-700"},n),r.a.createElement("div",{className:"flex flex-col items-start space-y-1"},a))},x=function(e){var t=e.sendMessage,n=e.sendTyping,c=e.clearMessages,s=e.clients,l=e.nickname,u=e.messages,i=Object(a.useState)([]),m=Object(f.a)(i,2),d=m[0],v=m[1],x=Object(a.useRef)(null);return Object(a.useEffect)((function(){var e=[],t=0,n=(u.map((function(n,a){0==a?e[t]=[n]:a>0&&n.sender===u[a-1].sender?e[t]=[].concat(Object(o.a)(e[t]),[n]):e[t+=1]=[n]})),e.map((function(e,t){var n=e[0].sender===l,a=e.map((function(e,t){return r.a.createElement(p,{isSender:n,createdAt:e.createdAt,key:t,text:e.text})}));return r.a.createElement(h,{isSender:n,sender:e[0].sender,key:t},a)})));console.log(e),v(n)}),[u,l]),Object(a.useEffect)((function(){x.current.scrollIntoView({behavior:"smooth"})}),[d]),r.a.createElement("div",{className:"h-full w-full  bg-gray-500 flex flex-col justify-end"},r.a.createElement(b,{clients:s}),r.a.createElement("div",{className:"flex-grow flex flex-col p-4 overflow-y-scroll"},d.length>0?r.a.createElement("button",{className:"text-gray-400",onClick:c},"Clear All"):r.a.createElement("span",null),d,r.a.createElement("div",{ref:x})),r.a.createElement(g,{sendMessage:t,sendTyping:n}))};function y(){var e=Object(m.a)(["\n  mutation {\n    clearMessages {\n      success\n    }\n  }\n"]);return y=function(){return e},e}function w(){var e=Object(m.a)(["\n  query {\n    messages {\n      sender\n      text\n      createdAt\n      updatedAt\n    }\n  }\n"]);return w=function(){return e},e}var E=n(93)("/"),j=Object(v.createHttpLink)({uri:"/graphql"}),O=new v.ApolloClient({link:j,cache:new v.InMemoryCache}),k=Object(v.gql)(w()),N=Object(v.gql)(y());var M=function(){var e=Object(a.useState)([]),t=Object(f.a)(e,2),n=t[0],c=t[1],s=Object(a.useState)([]),l=Object(f.a)(s,2),m=l[0],v=l[1],g=Object(a.useState)(!1),p=Object(f.a)(g,2),b=(p[0],p[1]),h=Object(d.useStateWithCallbackLazy)(""),y=Object(f.a)(h,2),w=y[0],j=y[1],M=function(){var e=Object(i.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.mutate({mutation:N});case 3:t=e.sent,t.data,c([]),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){return function(){var e=Object(i.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O.query({query:k});case 3:t=e.sent,n=t.data.messages,console.log(n),c(n),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error(e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}()(),E.on("bcMessage",(function(e){c((function(t){return[].concat(Object(o.a)(t),[e])}))})),E.on("nickname",(function(e,t,n){j(e,(function(){n()}));var a=t.filter((function(t){return t!==e}));v(a)})),E.on("typing",(function(){b(!0)})),function(){return E.disconnect()}}),[]),Object(a.useEffect)((function(){E.on("connectedClients",(function(e){var t=e.filter((function(e){return e!==w}));v(t)}))}),[w]);var S=function(){var e=Object(i.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(w),n={text:t,sender:w},E.emit("newMessage",n);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),C=function(){var e=Object(i.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:E.emit("typing");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"h-screen w-full"},r.a.createElement(x,{clients:m,nickname:w,messages:n,clearMessages:function(){return M()},sendMessage:function(e){return S(e)},sendTyping:function(){return C()}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));window.addEventListener("load",(function(){window.scrollTo(0,0)})),s.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},86:function(e,t,n){e.exports=n(133)},91:function(e,t,n){}},[[86,1,2]]]);
//# sourceMappingURL=main.cb421f6e.chunk.js.map